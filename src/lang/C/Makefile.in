# @configure_input@

package = @PACKAGE_NAME@
version = @PACKAGE_VERSION@
tarname = @PACKAGE_TARNAME@
distdir = $(tarname)-$(version)

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@

srcdir		= @srcdir@

CC		= @CC@
CFLAGS		= @CFLAGS@ 
CPPFLAGS	= -I../../.. -I$(srcdir)/../.. @CPPFLAGS@ 
LIBS		= @LIBS@ ds/queue.o dlmalloc/dlmalloc.o

TARGETS		= 1-1 1-2 2-1 2-2 2-3 2-4 3-1 4-1
SUBDIRS		= dlmalloc ds

all: $(TARGETS)
	$(MAKE) --directory=ds $@

clean:
	$(MAKE) --directory=ds $@
	$(MAKE) --directory=dlmalloc $@
	-rm -f $(TARGETS)

$(SUBDIRS):
	$(MAKE) --directory=$@

%.o: %.c $(SUBDIRS)
	$(CC) -c $(CPPFLAGS) -o $@ $< 

%: %.o
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS) 

test.o: test.c factor.h ds/queue.h

3-1: factor.o

test: test.o factor.o ds/queue.o dlmalloc/dlmalloc.o
	

check: test
	./test

Makefile: Makefile.in ../../../config.status
	cd ../../.. && ./config.status src/lang/C/$@

../../../config.status: ../../../configure
	cd ../../.. && ./config.status --recheck

.PHONY: clean check subdirs $(SUBDIRS)

