# @configure_input@

package = @PACKAGE_NAME@
version = @PACKAGE_VERSION@
tarname = @PACKAGE_TARNAME@
distdir = $(tarname)-$(version)

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@

srcdir		= @srcdir@

CC		= @CC@
CFLAGS		= @CFLAGS@ 
CPPFLAGS	= -I../../.. -I$(srcdir)/../.. @CPPFLAGS@ 
LIBS		= @LIBS@

TARGETS		= 1-1 1-2 2-1 2-2 2-3 2-4 3-1 4-1
SUBDIRS		= dlmalloc ds

all: $(TARGETS)
	$(MAKE) --directory=ds $@

clean:
	$(MAKE) --directory=ds $@
	$(MAKE) --directory=dlmalloc $@
	-rm -f $(TARGETS)

$(SUBDIRS):
	$(MAKE) --directory=$@

%.o: %.c $(SUBDIRS)
	$(CC) -c $(CPPFLAGS) -o $@ $< 

1-1: 1-1.o
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS) 

1-2: 1-2.o
	$(CC) $(CFLAGS) -o $@ $< $(LIBS) 

2-1: 2-1.o
	$(CC) $(CFLAGS) -o $@ $< $(LIBS) 

2-2: 2-2.o
	$(CC) $(CFLAGS) -o $@ $< $(LIBS) 

2-3: 2-3.o
	$(CC) $(CFLAGS) -o $@ $< $(LIBS) 

2-4: 2-4.o
	$(CC) $(CFLAGS) -o $@ $< $(LIBS) 

3-1: 3-1.o factor.o ds/queue.o dlmalloc/dlmalloc.o
	$(CC) $(CPPFLAGS) $(CFLAGS) -o $@ $^ $(LIBS) 

4-1: 4-1.c factor.o ds/queue.o dlmalloc/dlmalloc.o
	$(CC) $(CPPFLAGS) $(CFLAGS) -o $@ $^ $(LIBS) 

check: test
	./test

Makefile: Makefile.in ../../../config.status
	cd ../../.. && ./config.status src/lang/C/$@

../../../config.status: ../../../configure
	cd ../../.. && ./config.status --recheck

.PHONY: clean check subdirs $(SUBDIRS)

