# @configure_input@

package = @PACKAGE_NAME@
version = @PACKAGE_VERSION@
tarname = @PACKAGE_TARNAME@
distdir = $(tarname)-$(version)

prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@

srcdir		= @srcdir@

CC		= @CC@
CFLAGS		= @CFLAGS@ 
CPPFLAGS	= -I../../.. -I$(srcdir)/../.. @CPPFLAGS@ 
LIBS		= @LIBS@ ds/queue.o dlmalloc/dlmalloc.o

TARGETS		= 1-1 1-2 2-1 2-2 2-3 2-4 3-1 4-1 5-1 6-1 7-1 8-1
SUBDIRS		= dlmalloc ds

all: $(TARGETS)

clean:
	$(MAKE) --directory=ds $@
	$(MAKE) --directory=dlmalloc $@
	-rm -f $(TARGETS) *.o

$(SUBDIRS):
	$(MAKE) --directory=$@

%.o: %.c $(SUBDIRS)
	$(CC) -c $(CPPFLAGS) -o $@ $< 

%: %.o
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS) 

test.o: test.c factor.h ds/queue.h

3-1.o: 3-1.c

3-1: 3-1.o factor.o 

4-1.o: 4-1.c

4-1: 4-1.o palindrome.o factor.o
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS) 

5-1: 5-1.o algebra.o

7-1: 7-1.o sieve.o 

test: test.o factor.o palindrome.o algebra.o sieve.o
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS) 
	
check: test
	./test

Makefile: Makefile.in ../../../config.status
	cd ../../.. && ./config.status src/lang/C/$@

../../../config.status: ../../../configure
	cd ../../.. && ./config.status --recheck

.PHONY: clean check subdirs $(SUBDIRS)

